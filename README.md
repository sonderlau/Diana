# 命运 2 - 查询 Bot

🎯 目标：小日向



## 功能划分



| 分类      | 子项      | 状态    | 功能类型 | 频率   |
| --------- | --------- | ------- | -------- | ------ |
| 🧡常用查询 | 周报      | 🟢已完成 | 🤚人工    | Weekly |
|           | 日报      | 🟢已完成 | 🤚人工    | Daily  |
|           | 周常/巅峰 | 🟠开发中 |          |        |
|           | 武器Perk  | 🟠开发中 |          |        |
|           | Perk详情  | 🟠开发中 |          |        |
|           | 队伍      | 🔴未完成 |          |        |
|           | 老九      | 🟢已完成 | 🤚人工    | Weekly |
| 💙战绩查询 | 战绩      | 🔴未完成 |          |        |
|           | 突袭/raid | 🔴未完成 |          |        |
|           | 地牢      | 🔴未完成 |          |        |
|           | 宗师/日落 | 🔴未完成 |          |        |
|           | PVP/熔炉  | 🔴未完成 |          |        |
|           | 智谋      | 🔴未完成 |          |        |
| 🩶其他查询 | 生涯      | 🔴未完成 |          |        |
|           | 热力图    | 🔴未完成 |          |        |
|           | 名片      | 🔴未完成 |          |        |
|           | 称号      | 🔴未完成 |          |        |
|           | 皮肤      | 🔴未完成 |          |        |
|           | 锻造/红框 | 🔴未完成 |          |        |
|           | 光尘商店  | 🟢已完成 | 🤚人工    | Weekly |
|           | 挂机查询  | 🔴未完成 |          |        |
|           | help      | 🔴未完成 |          |        |



## 功能实现



### 武器查询

`#weapon 增压精准`

TODO：多语言查询

> 武器名称 -> 名称匹配 -> 武器Hash -> 查询Perk和数据 -> 绘制图片

> Clarity 数据库

> `DestinyInventoryItemDefinition` 
>
> 从新建立数据库，便于查找。
>
> 武器名称 - Hash

> 枪械 本地化存储图片
>
> 本地若不命中，则再发起网络请求，并本地备份



后坐力方向：x from [0, 100]
$$
Shots Direction = \sin((x+5) \cdot \frac{2\pi}{20})(100 - x)
$$

| 显示内容 | 字段位置                 |
| -------- | ------------------------ |
| 图标     | displayProperties / icon |
| 来源图标 | iconWaterMark            |
| 背景图   | screenshot               |
| 武器类型 | itemTypeDisplayName      |
| 个性说明 | flavorText               |
| Perks    | sockets                  |
| 各类属性 | investmentStats          |
|          |                          |
|          |                          |
|          |                          |
|          |                          |



### Perk 查询

`#perk 爆炸光能`

>Perk名称 -> 名称匹配 -> Perk Hash -> 官方解释 -> 社区解释(Clarity) -> 绘制图片



## 模块实现



### 绘图

使用多线程，对一张图片中的几个部分进行拆分。

每个线程绘制一部分，全部绘制完成后拼接成一张完整的图片。



### 进行的任务

使用 Redis 存储用户当前正在执行的任务

不可一人同时请求多个任务



### 请求数据

